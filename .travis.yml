env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: Ifg9GZqWLalCx/1pO+8krlbWvENHsXsRYDbwOeMLDWl73beUq/lbfagB/vWucGeU6V7mHdjUffYCaFv3KBvWeGpo9josBMvEh3uCpJYjGEpPlSSiOWbJrPs2TLxN2Gd05RoEQpw7FE2F8t+p2AzdsA80SFJKIkHDxEb63psMvbiLJXEDtXEfzV6vVJFUO7QqSmb//VnsS6+KJZ6judtv3lznW3CXYl8t2VFQbH78YQHCM+wJFO18vKxRybv4V7ZhJpeJc0SL79NMy6s6kb2+tct2hDkMxbqia/xMODMg0BEVDT3Eba77qcCM2HPPVvQUczJmIWRmcGSg8CA9EUBSy5A7jk/NFemEUht+o0gUR5J38mqf5CQ9OA4pCZBiGGCaAHOKbIu75mzKnA8yvadPb5Js7Ao29SoSeYnuRGtx5DJbiiamA6nWBrDLGqk2h72YxGCTFB5VvB+7Ey4z6UgI40PCfVLaVH+9G0n9P4d2IB8Qpo1wxvuETAexKr7XfuscEogTOoYntSofL5i0dSODnPUcw6C2ZS4N2xWh3ZopgdXo1RZvTPRYHlE34zf1EsDt4pZ94MWkUkf0en+jICPzbIpmboPCk7Cdzrfo2+bIaQIPIoomWL39UcyBmuOei+K3Fj2u8ZRK9TCyffjNJ0pXSxGeONyO3R2PNAiwBm8X7bg=
  - secure: rp2KJSLTqKRFUwgeRte2rtZ0P/TsemiPJHf4MQL5+ZTNnIhWIUkZhhklPZkCjjhq1NXsCbvi7fQInl7PqXBWQ29ZeaDQ9fPkCL65D5OZIKQYYyYyMY7Tavl3UYxAGKUKivhwBQSIUQYHPGkRKGd1Q3sAScDpH0vBB0f6EXMR/qeXj3tWvr9TMrkGUpEWsvLfZ2Gn8kTwIACUb59ap8CxsnRIoY25doo7Ct5DoLwP5XieIdnBcsXsHoicTwJYCTHZVdqBCondDIi76AFyGtLqPNllfvgJ3JadhknTqJ8WbLVyHGYckYlj9rr9GbYBWm2Bf0gyCqzF1uu6GQ4MGeha9AX1AZMYVJfjl5QoD52UcMJAmAlL7gXHh87dRNkhZEin0yDpEd0m4YC1uFAxtpPUdo0IyKdY2v955b21hFXtGJ8WTJW12baexTULNzWBsm3bGamxvSJXdC0/GI0ibxaY9i+dHwxV+V8T1MelUgj9rLxlQFsZ3Imme5rQurhCvp3DPOQnMotoq4EvYXk4YbEKofcj8gyfdvg99xWZTIhBI8ISKWnP4tzuxWpnLpVrC4pPznSFkFIZeNQGr/l3xUIYPQmKqBAYaDszKflPZhh4uNY5Iy5gv+zAZsr7IYAbag5PtwKH5v0qQUY9UYypzkR0LhaW4lMQ+pZx3FDIQjfeU4U=
  - secure: lSnKo9edXue7hSEFGYKMq4ZjnBNUJaug35zYI7TKU5D2Ce6IUcTrfUT8EXHP4qXw4Yw+oIr0TwjZiQ/h46X++M9ZM614mNa0wia0adzngPJYEF371H92tNV/6DdPPv4gfQ/wN5QPqEMphAcM4U5/2X5LDI1vOl56N4MtFDpv+5U+uG0K2egoftDpMuqpiXFuvvD8pvsbWOGfWdWxfb/WueShik4EhuRfHg1N6Q+EGLQCZICPYW7fruq7y+qCoJdpxd1djsPQcNg/vI4VDXz7BYvYMsUuXVb1PFn6LalJxB0yaj00/UDopGZsq1pNHlNSBYCpRxrUurP6OClcggcloM8NReCHhaAsuVcAe8LpkGBtsLUliYRqsChK0F3suGYsumo5xE+DK5isYli9nYA4GKqXf94l7TYJ64UCQRG43FjwBcI9Ki8QAAFZ/qZc5pdBGUZCK0hTKOn6EQvEjwTbm/SHfl7iiHrIINOx/H8xqMeWInqa3jYOc1CQWHbRTo0pbI3fr+p21dkrvjM2aY3i1wvDcNH/sVj+FEfilEIJogeSUpi7R9Lv8i5jYJ6G2Y9YE0GBR4hjb1srlJUq7gaCYZKDOocmWGEntoevomLmCymtIf1sPifMUBty1R7j31hQnb401O/7kWOyzu8p4UM3J5mA9imh00yclGzYgdwr+Do=

script: echo "Build"
after_success: 
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=engelphi/docker-cpp-image
  - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
  - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH, PR=$PR, BRANCH=$BRANCH"
  - export TAG=$(if [ "$BRANCH" == "master" ]; then echo "latest"; else echo $BRANCH; fi)
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
